<!DOCTYPE html>
<html>

    <head>
        <title>Aplicativo (create)</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="/site/sakura.css">
    </head>

    <body>
        <p><a href="/">&lt; Voltar para página inicial</a></p>
        <h1>Novo Aplicativo</h1>
        <table>
            <tr>
                <td>Nome:</td>
                <td><input type="text" id="txtNome"></td>
            </tr>
            <tr>
                <td>Desenvolvedor:</td>
                <td><input type="text" id="txtDesenvolvedor"></td>
            </tr>
            <tr>
                <td>Número de Downloads:</td>
                <td><input type="text" id="txtNDownloads"></td>
            </tr>
            <tr>
                <td></td>
                <td><input type="button" onclick="criarAplicativo()" value="Criar"></td>
            </tr>
        </table>
        <p style="font-weight:bold" id="mensagem"></p>
        <script>
            const textoNome = document.querySelector('#txtNome');
            const textoDesenvolvedor= document.querySelector('#txtDesenvolvedor');
            const textoNDownloads= document.querySelector('#txtNDownloads');

            const paragrafoMensagem = document.querySelector('#mensagem');

            function mostrarMensagem(aplicativoCadastrado) {
            textoNome.value = '';
            textoDesenvolvedor.value = '';
            textoNDownloads.value = '';
            
            paragrafoMensagem.innerHTML = 'Aplicativo criado com id ' + aplicativoCadastrado.id;
            }
            
            async function criarAplicativo() {
            const URL = `/api/aplicativos`;
            const dadosAplicativo = {
            'nome': textoNome.value,
            'desenvolvedor': textoDesenvolvedor.value,
            'nDownloads': textoNDownloads.value

            };
            const postRequest = {
            method: 'POST',
            body: JSON.stringify(dadosAplicativo),
            headers: {
            'Content-type': 'application/json;charset=UTF-8'
            }
            };
            try {
            fetch(URL, postRequest).then(resposta => resposta.json()).then(jsonResponse => mostrarMensagem(jsonResponse));
            } catch (e) {
            paragrafoMensagem.innerHTML = e;
            }
            }
        </script>
    </body>

</html>